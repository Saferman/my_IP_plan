# Two-Step RSS生成器逻辑介绍

## 概述
`two_step.py` 是一个智能的RSS文件生成器，用于将HTML文件批量转换为WordPress可导入的RSS格式。该工具支持两种工作模式：重复判断模式和全量处理模式，能够灵活处理不同的内容更新需求。

## 核心功能

### 1. 双模式运行机制
- **重复判断模式** (`add_update = True`)：检查已提交的文件，避免重复处理
- **全量处理模式** (`add_update = False`)：处理所有HTML文件，不进行重复检查

### 2. 智能日期分配
- **更新模式**：新文章使用指定日期范围（`update_date` 到今天）的随机日期
- **历史模式**：使用2016-2025年份池，确保年份分布均匀

### 3. 批量处理
- 将HTML文件按批次（默认30个/批）分组生成RSS文件
- 支持大量文件的自动化处理

## 工作流程

### 第一阶段：文件准备
1. **模式选择**：根据 `add_update` 参数决定运行模式
2. **重复检查**（仅更新模式）：
   - 扫描 `posted_rss` 目录下的所有RSS文件
   - 提取已提交的HTML文件名
   - 过滤掉重复文件
3. **文件收集**：获取 `newdata` 目录下的所有HTML文件

### 第二阶段：内容处理
1. **文件随机化**：打乱文件顺序，确保随机性
2. **批次划分**：按 `batch_size` 参数将文件分组
3. **内容提取**：
   - 解析HTML文件获取标题
   - 提取 `<header>` 到 `<footer>` 之间的内容
   - 清理非法字符

### 第三阶段：RSS生成
1. **日期分配**：
   - 更新模式：使用 `random_date_range()` 在指定范围内生成日期
   - 历史模式：使用 `random_date()` 从年份池中选择
2. **RSS构建**：
   - 创建RSS 2.0格式的XML结构
   - 为每个文件生成 `<item>` 元素
   - 包含标题、链接、发布日期、描述等字段
3. **文件输出**：生成格式化的XML文件到 `rss` 目录

## 关键参数说明

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `new_html_dir` | HTML文件源目录 | "newdata" |
| `rss_dir` | RSS输出目录 | "rss" |
| `posted_rss_dir` | 已提交RSS文件目录 | "posted_rss" |
| `base_link` | 网站基础链接 | "https://cscodetutor.com/" |
| `batch_size` | 每批文件数量 | 30 |
| `update_date` | 新文章起始日期 | "2025-07-19" |
| `add_update` | 是否启用重复判断 | True |

## 使用场景

### 场景1：内容更新（add_update = True）
- **适用情况**：定期添加新内容，需要避免重复提交
- **日期策略**：新文章使用较新的日期，体现内容时效性
- **处理逻辑**：智能跳过已处理文件，只处理新增内容

### 场景2：全量重建（add_update = False）
- **适用情况**：首次部署或需要重新生成所有RSS
- **日期策略**：使用历史年份池，模拟长期积累的内容
- **处理逻辑**：处理所有文件，不进行重复检查

## 技术特点

### 1. 容错处理
- 自动创建必要的目录结构
- 处理文件读取和解析异常
- 支持不完整或格式异常的HTML文件

### 2. 内容清理
- 移除HTML中的控制字符
- 保持中文字符的完整性
- 生成符合RSS标准的XML格式

### 3. 随机化策略
- 文件顺序随机化
- 日期分配随机化
- 确保每次运行结果不同

## 输出结果

生成的RSS文件具有以下特点：
- 符合RSS 2.0标准格式
- 包含完整的文章元数据
- 支持WordPress直接导入
- 文件命名规范：`rss_1.xml`, `rss_2.xml` 等

## 扩展性

该工具设计具有良好的扩展性：
- 可轻松修改日期生成策略
- 支持自定义文件过滤规则
- 可调整批次大小和输出格式
- 便于集成到自动化工作流中 